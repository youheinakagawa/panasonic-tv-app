<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Panasonic TV Remote</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 20px;
        background-color: #f0f0f0;
      }
      
      h1 {
        color: #333;
      }
      
      .remote {
        background-color: #333;
        border-radius: 10px;
        padding: 20px;
        width: 90%;
        max-width: 400px;
        margin: 20px auto;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      }

      /* レスポンシブデザイン用のメディアクエリ */
      @media (max-width: 480px) {
        .remote {
          width: 95%;
          padding: 15px;
        }
        .remote-button {
          padding: 8px 12px;
          font-size: 14px;
          min-width: 40px;
        }
      }
      
      @media (min-width: 768px) {
        .remote {
          max-width: 500px;
        }
      }
    
    .remote-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
    }
    
    .power-button {
      background-color: #e74c3c;
      color: white;
      border: none;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      font-size: 16px;
      cursor: pointer;
    }
    
    .tv-info {
      color: white;
      font-size: 14px;
    }
    
    .button-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 15px;
    }
    
    .remote-button {
      background-color: #555;
      color: white;
      border: none;
      border-radius: 5px;
      padding: 10px 15px;
      font-size: 16px;
      cursor: pointer;
      min-width: 50px;
      text-align: center;
    }
    
    .remote-button:hover {
      background-color: #777;
    }
    
    .volume-channel {
      display: flex;
      justify-content: space-between;
      margin: 20px 0;
    }
    
    .volume, .channel {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    
    .volume-label, .channel-label {
      color: white;
      margin-bottom: 10px;
    }
    
    .back-button {
      background-color: #3498db;
      color: white;
      border: none;
      border-radius: 5px;
      padding: 10px 15px;
      font-size: 16px;
      cursor: pointer;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h1>Panasonic TV Remote</h1>
  
  <div class="remote">
    <div class="remote-header">
      <div class="tv-info">
        <div id="tv-ip"></div>
      </div>
      <button class="power-button" id="power">電源</button>
    </div>
    
    <div class="button-row">
      <button class="remote-button">1</button>
      <button class="remote-button">2</button>
      <button class="remote-button">3</button>
    </div>
    
    <div class="button-row">
      <button class="remote-button">4</button>
      <button class="remote-button">5</button>
      <button class="remote-button">6</button>
    </div>
    
    <div class="button-row">
      <button class="remote-button">7</button>
      <button class="remote-button">8</button>
      <button class="remote-button">9</button>
    </div>
    
    <div class="button-row">
      <button class="remote-button">*</button>
      <button class="remote-button">0</button>
      <button class="remote-button">#</button>
    </div>
    
    <div class="volume-channel">
      <div class="volume">
        <div class="volume-label">Volume</div>
        <button class="remote-button" id="volume-up">+</button>
        <button class="remote-button" id="volume-down">-</button>
      </div>
      
      <div class="channel">
        <div class="channel-label">Channel</div>
        <button class="remote-button" id="channel-up">channel-up</button>
        <button class="remote-button" id="channel-down">channel-down</button>
      </div>
    </div>
    
    <div class="button-row">
      <button class="remote-button" id="menu">Menu</button>
      <button class="remote-button" id="home">Home</button>
      <button class="remote-button" id="back">Back</button>
    </div>
    
    <!-- 方向キー -->
    <div style="margin-top: 15px;">
      <div style="color: white; margin-bottom: 10px;">方向キー</div>
      <div style="display: flex; flex-direction: column; align-items: center;">
        <button class="remote-button" id="up">up</button>
        <div style="display: flex; justify-content: space-between; width: 150px; margin: 5px 0;">
          <button class="remote-button" id="left">left</button>
          <button class="remote-button" id="enter">enter</button>
          <button class="remote-button" id="right">right</button>
        </div>
        <button class="remote-button" id="down">down</button>
      </div>
    </div>
    
    <!-- カラーボタン -->
    <div style="margin-top: 15px;">
      <div style="color: white; margin-bottom: 10px;">カラーボタン</div>
      <div class="button-row">
        <button class="remote-button" id="red" style="background-color: #e74c3c;">red</button>
        <button class="remote-button" id="green" style="background-color: #2ecc71;">green</button>
        <button class="remote-button" id="yellow" style="background-color: #f1c40f;">yellow</button>
        <button class="remote-button" id="blue" style="background-color: #3498db;">blue</button>
      </div>
    </div>
    
    <!-- その他のボタン -->
    <div style="margin-top: 15px;">
      <div style="color: white; margin-bottom: 10px;">その他</div>
      <div class="button-row">
        <button class="remote-button" id="info">info</button>
        <button class="remote-button" id="guide">guide</button>
        <button class="remote-button" id="mute">mute</button>
      </div>
    </div>
    
    <!-- その他のボタン -->
    <div style="margin-top: 15px;">
      <div style="color: white; margin-bottom: 10px;">その他</div>
      <div class="button-row">
        <button class="remote-button" id="subtitles">字幕</button>
        <button class="remote-button" id="split">画面分割</button>
      </div>
    </div>
    
    <!-- メディア制御 -->
    <div style="margin-top: 15px;">
      <div style="color: white; margin-bottom: 10px;">メディア制御</div>
      <div class="button-row">
        <button class="remote-button" id="rewind">rewind</button>
        <button class="remote-button" id="play">play</button>
        <button class="remote-button" id="forward">forward</button>
      </div>
      <div class="button-row" style="margin-top: 5px;">
        <button class="remote-button" id="prev">prev</button>
        <button class="remote-button" id="stop">stop</button>
        <button class="remote-button" id="next">next</button>
      </div>
    </div>
    
    <!-- アプリ -->
    <div style="margin-top: 15px;">
      <div style="color: white; margin-bottom: 10px;">アプリ</div>
      <div class="button-row">
        <button class="remote-button" id="apps">Apps</button>
      </div>
      <div class="button-row" style="margin-top: 5px;">
        <button class="remote-button" id="viera-tools">VIERA Tools</button>
        <button class="remote-button" id="viera-connect">VIERA Connect</button>
      </div>
      <div class="button-row" style="margin-top: 5px;">
        <button class="remote-button" id="viera-link">VIERA Link</button>
        <button class="remote-button" id="vod">VOD</button>
        <button class="remote-button" id="game">Game</button>
      </div>
      <div id="room-jump-link-container" style="display: none; margin-top: 5px;">
        <button class="remote-button" id="room-jump-link" style="width: 100%; background-color: #27ae60;">お部屋ジャンプリンク</button>
      </div>
      
      <!-- 追加アプリ -->
      <div style="margin-top: 15px;">
        <div style="color: white; margin-bottom: 10px;">追加アプリ</div>
        <div class="button-row">
          <button class="remote-button" id="browser" style="background-color: #3498db;">ブラウザ</button>
          <button class="remote-button" id="media-player" style="background-color: #9b59b6;">メディアプレーヤー</button>
        </div>
        <div class="button-row" style="margin-top: 5px;">
          <button class="remote-button" id="tv-menu" style="background-color: #f39c12;">テレビメニュー</button>
          <button class="remote-button" id="favorite" style="background-color: #e74c3c;">お気に入り</button>
        </div>
      </div>
    </div>
    
      <div class="input-section" style="margin-top: 15px;">
      <div class="input-label" style="color: white; margin-bottom: 10px;">入力切替</div>
      <div class="button-row">
        <button class="remote-button input-button" id="tv-change" style="background-color: #2980b9;">テレビ切替</button>
        <button class="remote-button input-button" id="input-change" style="background-color: #e67e22;">入力切替</button>
      </div>
    </div>
    
    <button class="back-button" id="return-to-search">Return to Search</button>
  </div>
  
  <script>
    const { ipcRenderer } = require('electron');
    
    // Get TV information from query parameters
    const urlParams = new URLSearchParams(window.location.search);
    const tvIp = urlParams.get('ip');
    const tvPort = urlParams.get('port') || '55000'; // Default to port 55000 if not specified
    const tvName = urlParams.get('name') || 'Panasonic TV';
    const tvModel = urlParams.get('model') || '';
    const avTransportControlURL = urlParams.get('avTransportControlURL');
    const renderingControlURL = urlParams.get('renderingControlURL');
    const hasRoomJumpLink = urlParams.get('roomJumpLink') === 'true';
    const hasAppList = urlParams.get('hasAppList') === 'true';
    
    console.log(`TV Info - IP: ${tvIp}, Port: ${tvPort}, Name: ${tvName}, Model: ${tvModel}`);
    console.log(`Service URLs - AVTransport: ${avTransportControlURL}, RenderingControl: ${renderingControlURL}`);
    console.log(`Features - Room Jump Link: ${hasRoomJumpLink}, App List: ${hasAppList}`);
    
    // お部屋ジャンプリンク機能が利用可能な場合、ボタンを表示
    if (hasRoomJumpLink) {
      document.getElementById('room-jump-link-container').style.display = 'block';
    }
    
    document.getElementById('tv-ip').textContent = tvName;
    
    // Add model information if available
    if (tvModel.trim()) {
      const modelElem = document.createElement('div');
      modelElem.textContent = tvModel;
      modelElem.style.fontSize = '12px';
      document.querySelector('.tv-info').appendChild(modelElem);
    }
    
    // Add IP information
    const ipElem = document.createElement('div');
    ipElem.textContent = `${tvIp}:${tvPort}`;
    ipElem.style.fontSize = '12px';
    document.querySelector('.tv-info').appendChild(ipElem);
    
    // Add event listeners for remote buttons
    document.querySelectorAll('.remote-button, .power-button, .input-button').forEach(button => {
      button.addEventListener('click', () => {
        const command = button.textContent.trim();
        console.log(`Button pressed: ${command}`);
        
        // Send command to main process
        ipcRenderer.send('tv-command', {
          ip: tvIp,
          port: tvPort,
          command: command,
          avTransportControlURL: avTransportControlURL,
          renderingControlURL: renderingControlURL
        });
      });
    });
    
    // Listen for command result
    ipcRenderer.on('tv-command-result', (event, result) => {
      console.log(result);
      if (result.success) {
        // Show a small notification that fades out
        const notification = document.createElement('div');
        notification.textContent = `Command ${result.command} sent`;
        notification.style.position = 'fixed';
        notification.style.bottom = '20px';
        notification.style.left = '50%';
        notification.style.transform = 'translateX(-50%)';
        notification.style.backgroundColor = '#4CAF50';
        notification.style.color = 'white';
        notification.style.padding = '10px';
        notification.style.borderRadius = '5px';
        notification.style.opacity = '1';
        notification.style.transition = 'opacity 1s';
        
        document.body.appendChild(notification);
        
        setTimeout(() => {
          notification.style.opacity = '0';
          setTimeout(() => {
            document.body.removeChild(notification);
          }, 1000);
        }, 2000);
      } else {
        // Show error notification that stays longer
        const errorNotification = document.createElement('div');
        errorNotification.textContent = `Error: ${result.message}`;
        errorNotification.style.position = 'fixed';
        errorNotification.style.bottom = '20px';
        errorNotification.style.left = '50%';
        errorNotification.style.transform = 'translateX(-50%)';
        errorNotification.style.backgroundColor = '#e74c3c';
        errorNotification.style.color = 'white';
        errorNotification.style.padding = '10px';
        errorNotification.style.borderRadius = '5px';
        errorNotification.style.opacity = '1';
        errorNotification.style.transition = 'opacity 1s';
        errorNotification.style.maxWidth = '80%';
        errorNotification.style.textAlign = 'center';
        
        document.body.appendChild(errorNotification);
        
        setTimeout(() => {
          errorNotification.style.opacity = '0';
          setTimeout(() => {
            document.body.removeChild(errorNotification);
          }, 1000);
        }, 5000); // Show error for 5 seconds
      }
    });
    
    // Return to search page
    document.getElementById('return-to-search').addEventListener('click', () => {
      window.location.href = 'index.html';
    });
    
    // Add keyboard event listener
    document.addEventListener('keydown', (event) => {
      console.log(`Key pressed: ${event.key}, Shift: ${event.shiftKey}, Ctrl: ${event.ctrlKey}`);
      let command = null;
      
      // Map keys to commands
      switch (event.key) {
        // アプリ関連のショートカット
        case 'f1':
          command = 'ブラウザ';
          break;
        case 'f2':
          command = 'メディアプレーヤー';
          break;
        case 'f3':
          command = 'テレビメニュー';
          break;
        case 'f4':
          command = 'お気に入り';
          break;
        case 'f5':
          if (hasRoomJumpLink) {
            command = 'お部屋ジャンプリンク';
          }
          break;
        // Numbers
        case '0':
        case '1':
        case '2':
        case '3':
        case '4':
        case '5':
        case '6':
        case '7':
        case '8':
        case '9':
          command = event.key;
          break;
        
        // Volume
        case '+':
        case '=': // = is on the same key as + on most keyboards
          command = '+';
          break;
        case '-':
          command = '-';
          break;
        
        // Direction/Channel/Volume with modifiers
        case 'ArrowUp':
          if (event.shiftKey) {
            command = 'channel-up';
          } else if (event.ctrlKey) {
            command = '+'; // Volume up
          } else {
            command = 'up'; // Direction up
          }
          break;
        case 'ArrowDown':
          if (event.shiftKey) {
            command = 'channel-down';
          } else if (event.ctrlKey) {
            command = '-'; // Volume down
          } else {
            command = 'down'; // Direction down
          }
          break;
        
        // Navigation
        case 'Escape':
        case 'Backspace':
          command = 'Back';
          break;
        case 'Home':
          command = 'Home';
          break;
        case 'm':
          command = 'Menu';
          break;
        case 'p':
          command = '電源'; // Power
          break;
        
        // Input switching
        case 't':
          command = 'テレビ切替';
          break;
        case 'h':
        case 'j':
        case 'k':
        case 'l':
        case 'i':
          if (event.key === 'i' && !event.ctrlKey) {
            command = 'info';
            break;
          }
          command = '入力切替';
          break;
          
        // Direction
        case 'ArrowLeft':
          command = 'left';
          break;
        case 'ArrowRight':
          command = 'right';
          break;
        case 'Enter':
          command = 'enter';
          break;
          
        // Color buttons
        case 'r':
          command = 'red';
          break;
        case 'g':
          command = 'green';
          break;
        case 'y':
          command = 'yellow';
          break;
        case 'b':
          command = 'blue';
          break;
          
        // Other
        case 'u':
          command = 'guide'; // EPG
          break;
        case 's':
          command = 'subtitles';
          break;
        case 'x':
          command = 'text'; // Teletext
          break;
        case 'q':
          command = 'mute';
          break;
          
        // Media control
        case ' ': // Space
          command = 'play';
          break;
        case 'z':
          command = 'rewind';
          break;
        case 'c':
          command = 'forward';
          break;
        case 'a':
          command = 'prev';
          break;
        case 'd':
          command = 'next';
          break;
        case 'v':
          command = 'stop';
          break;
        case 'w':
          command = 'record';
          break;
        case 's':
          command = '字幕';
          break;
        case 'v':
          command = '画面分割';
          break;
      }
      
      // If a command was mapped, send it
      if (command) {
        console.log(`Sending keyboard command: ${command}`);
        
        // Send command to main process
        ipcRenderer.send('tv-command', {
          ip: tvIp,
          port: tvPort,
          command: command,
          avTransportControlURL: avTransportControlURL,
          renderingControlURL: renderingControlURL
        });
        
        // Prevent default action (e.g., scrolling with arrow keys)
        event.preventDefault();
      }
    });
  </script>
</body>
</html>
