<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Panasonic TV Remote</title>
</head>
<body>
  <h1>Panasonic TV Remote</h1>
  <button id="search-tv">Search TV</button>
  <ul id="tv-list"></ul>

  <script>
    const { ipcRenderer } = require('electron');

    const searchTvButton = document.getElementById('search-tv');
    const tvList = document.getElementById('tv-list');

    let searchTimeout;

    searchTvButton.addEventListener('click', () => {
      tvList.innerHTML = '<li>Searching for TVs...</li>';
      ipcRenderer.send('search-tv');
      
      // Set a timeout to show "No TVs found" if no TVs are found within 5 seconds
      clearTimeout(searchTimeout);
      searchTimeout = setTimeout(() => {
        if (tvList.innerHTML === '<li>Searching for TVs...</li>') {
          tvList.innerHTML = '<li>No Panasonic TVs found</li>';
        }
      }, 5000);
    });

    ipcRenderer.on('tv-found', (event, devices) => {
      clearTimeout(searchTimeout);
      tvList.innerHTML = '';
      
      devices.forEach(device => {
        const li = document.createElement('li');
        
        // Create a div for TV details
        const detailsDiv = document.createElement('div');
        
        // Add TV name and model if available
        if (device.friendlyName) {
          const nameElem = document.createElement('strong');
          nameElem.textContent = device.friendlyName;
          detailsDiv.appendChild(nameElem);
          detailsDiv.appendChild(document.createElement('br'));
        }
        
        // Add model information if available
        if (device.modelName || device.modelNumber) {
          const modelElem = document.createElement('span');
          modelElem.textContent = `${device.modelName || ''} ${device.modelNumber || ''}`.trim();
          detailsDiv.appendChild(modelElem);
          detailsDiv.appendChild(document.createElement('br'));
        }
        
        // Add IP address
        const ipElem = document.createElement('span');
        ipElem.textContent = `IP: ${device.ip}:${device.port}`;
        detailsDiv.appendChild(ipElem);
        
        li.appendChild(detailsDiv);
        
        // Add a button to control the TV
        const button = document.createElement('button');
        button.textContent = 'Control';
        button.style.marginLeft = '10px';
        button.onclick = () => {
          window.location.href = `remote.html?ip=${device.ip}&port=${device.port}&name=${encodeURIComponent(device.friendlyName || 'Panasonic TV')}&model=${encodeURIComponent((device.modelName || '') + ' ' + (device.modelNumber || ''))}`;
        };
        
        li.appendChild(document.createTextNode(' '));
        li.appendChild(button);
        tvList.appendChild(li);
      });
    });
  </script>
</body>
</html>
